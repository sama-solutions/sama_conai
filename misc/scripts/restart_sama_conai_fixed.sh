#!/bin/bash\n\n# Script de redÃ©marrage intelligent SAMA CONAI\necho \"ğŸ”„ RedÃ©marrage intelligent SAMA CONAI...\"\n\n# ArrÃªter les processus existants\necho \"â¹ï¸ ArrÃªt des processus existants...\"\npkill -f \"node server.js\" 2>/dev/null || true\npkill -f \"node proxy_server.js\" 2>/dev/null || true\npkill -f \"python3 odoo-bin\" 2>/dev/null || true\n\n# Attendre que les processus se terminent\nsleep 3\n\n# Nettoyer les fichiers PID\nrm -f pids/*.pid 2>/dev/null || true\n\n# RedÃ©marrer Odoo en arriÃ¨re-plan\necho \"ğŸ›ï¸ DÃ©marrage du backend Odoo...\"\npython3 odoo-bin -c odoo_iframe_config.conf -d sama_conai_analytics \\\n  --addons-path=/var/odoo/odoo18/addons,/home/grand-as/psagsn/custom_addons \\\n  --http-port=8077 --log-level=info \\\n  --logfile=logs/odoo.log --pidfile=pids/odoo.pid &\n\n# Attendre qu'Odoo dÃ©marre\necho \"â³ Attente du dÃ©marrage d'Odoo...\"\nsleep 10\n\n# VÃ©rifier qu'Odoo rÃ©pond\nfor i in {1..30}; do\n  if curl -s http://localhost:8077 >/dev/null 2>&1; then\n    echo \"âœ… Odoo dÃ©marrÃ© avec succÃ¨s\"\n    break\n  fi\n  echo \"   Tentative $i/30...\"\n  sleep 2\ndone\n\n# DÃ©marrer le proxy\necho \"ğŸ”— DÃ©marrage du proxy iframe...\"\ncd mobile_app_web\nnode proxy_server.js > ../logs/proxy_server.log 2>&1 &\necho $! > ../pids/proxy_server.pid\n\n# Attendre que le proxy dÃ©marre\nsleep 3\n\n# DÃ©marrer l'application mobile\necho \"ğŸ“± DÃ©marrage de l'application mobile...\"\nnode server.js > ../logs/mobile_app.log 2>&1 &\necho $! > ../pids/mobile_app.pid\n\n# Attendre que l'app mobile dÃ©marre\nsleep 5\n\n# VÃ©rifier que tous les services rÃ©pondent\necho \"\"\necho \"ğŸ” VÃ©rification des services...\"\n\nif curl -s http://localhost:8077 >/dev/null 2>&1; then\n  echo \"âœ… Backend Odoo (8077): OK\"\nelse\n  echo \"âŒ Backend Odoo (8077): ERREUR\"\nfi\n\nif curl -s http://localhost:8078 >/dev/null 2>&1; then\n  echo \"âœ… Proxy iframe (8078): OK\"\nelse\n  echo \"âŒ Proxy iframe (8078): ERREUR\"\nfi\n\nif curl -s http://localhost:3005 >/dev/null 2>&1; then\n  echo \"âœ… Application mobile (3005): OK\"\nelse\n  echo \"âŒ Application mobile (3005): ERREUR\"\nfi\n\necho \"\"\necho \"ğŸ¯ SAMA CONAI redÃ©marrÃ© avec succÃ¨s!\"\necho \"ğŸ“± Application mobile: http://localhost:3005\"\necho \"ğŸ›ï¸ Backend Odoo: http://localhost:8077\"\necho \"ğŸ”— Proxy iframe: http://localhost:8078\"\necho \"\"\necho \"ğŸ‘¤ Credentials: admin/admin\""