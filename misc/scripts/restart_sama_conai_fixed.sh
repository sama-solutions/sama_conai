#!/bin/bash\n\n# Script de redémarrage intelligent SAMA CONAI\necho \"🔄 Redémarrage intelligent SAMA CONAI...\"\n\n# Arrêter les processus existants\necho \"⏹️ Arrêt des processus existants...\"\npkill -f \"node server.js\" 2>/dev/null || true\npkill -f \"node proxy_server.js\" 2>/dev/null || true\npkill -f \"python3 odoo-bin\" 2>/dev/null || true\n\n# Attendre que les processus se terminent\nsleep 3\n\n# Nettoyer les fichiers PID\nrm -f pids/*.pid 2>/dev/null || true\n\n# Redémarrer Odoo en arrière-plan\necho \"🏛️ Démarrage du backend Odoo...\"\npython3 odoo-bin -c odoo_iframe_config.conf -d sama_conai_analytics \\\n  --addons-path=/var/odoo/odoo18/addons,/home/grand-as/psagsn/custom_addons \\\n  --http-port=8077 --log-level=info \\\n  --logfile=logs/odoo.log --pidfile=pids/odoo.pid &\n\n# Attendre qu'Odoo démarre\necho \"⏳ Attente du démarrage d'Odoo...\"\nsleep 10\n\n# Vérifier qu'Odoo répond\nfor i in {1..30}; do\n  if curl -s http://localhost:8077 >/dev/null 2>&1; then\n    echo \"✅ Odoo démarré avec succès\"\n    break\n  fi\n  echo \"   Tentative $i/30...\"\n  sleep 2\ndone\n\n# Démarrer le proxy\necho \"🔗 Démarrage du proxy iframe...\"\ncd mobile_app_web\nnode proxy_server.js > ../logs/proxy_server.log 2>&1 &\necho $! > ../pids/proxy_server.pid\n\n# Attendre que le proxy démarre\nsleep 3\n\n# Démarrer l'application mobile\necho \"📱 Démarrage de l'application mobile...\"\nnode server.js > ../logs/mobile_app.log 2>&1 &\necho $! > ../pids/mobile_app.pid\n\n# Attendre que l'app mobile démarre\nsleep 5\n\n# Vérifier que tous les services répondent\necho \"\"\necho \"🔍 Vérification des services...\"\n\nif curl -s http://localhost:8077 >/dev/null 2>&1; then\n  echo \"✅ Backend Odoo (8077): OK\"\nelse\n  echo \"❌ Backend Odoo (8077): ERREUR\"\nfi\n\nif curl -s http://localhost:8078 >/dev/null 2>&1; then\n  echo \"✅ Proxy iframe (8078): OK\"\nelse\n  echo \"❌ Proxy iframe (8078): ERREUR\"\nfi\n\nif curl -s http://localhost:3005 >/dev/null 2>&1; then\n  echo \"✅ Application mobile (3005): OK\"\nelse\n  echo \"❌ Application mobile (3005): ERREUR\"\nfi\n\necho \"\"\necho \"🎯 SAMA CONAI redémarré avec succès!\"\necho \"📱 Application mobile: http://localhost:3005\"\necho \"🏛️ Backend Odoo: http://localhost:8077\"\necho \"🔗 Proxy iframe: http://localhost:8078\"\necho \"\"\necho \"👤 Credentials: admin/admin\""