#!/bin/bash\n\n# ========================================= #\n# SAMA CONAI - LANCEMENT VERSION ODOO RÉELLE #\n# ========================================= #\n\necho \"🇸🇳 SAMA CONAI - Version Odoo Réelle\"\necho \"====================================\"\necho \"\"\n\n# Couleurs\nGREEN='\\033[0;32m'\nBLUE='\\033[0;34m'\nYELLOW='\\033[1;33m'\nRED='\\033[0;31m'\nPURPLE='\\033[0;35m'\nCYAN='\\033[0;36m'\nNC='\\033[0m'\n\nprint_step() {\n    echo -e \"${BLUE}➤${NC} $1\"\n}\n\nprint_success() {\n    echo -e \"${GREEN}✅${NC} $1\"\n}\n\nprint_warning() {\n    echo -e \"${YELLOW}⚠️${NC} $1\"\n}\n\nprint_error() {\n    echo -e \"${RED}❌${NC} $1\"\n}\n\nprint_info() {\n    echo -e \"${CYAN}ℹ️${NC} $1\"\n}\n\n# Variables\nPORT=3008\nSERVER_FILE=\"mobile_app_web/server_odoo_real.js\"\nPID_FILE=\"pids/sama_conai_odoo_real.pid\"\nLOG_FILE=\"logs/sama_conai_odoo_real_$(date +%Y%m%d_%H%M%S).log\"\n\n# Vérification des prérequis\nprint_step \"Vérification des prérequis...\"\n\nif [ ! -f \"$SERVER_FILE\" ]; then\n    print_error \"Serveur Odoo réel non trouvé: $SERVER_FILE\"\n    exit 1\nfi\n\nif [ ! -f \"mobile_app_web/public/sama_conai_odoo_real.html\" ]; then\n    print_error \"Interface Odoo réelle non trouvée\"\n    exit 1\nfi\n\nif [ ! -f \"mobile_app_web/odoo_connector.js\" ]; then\n    print_error \"Connecteur Odoo non trouvé\"\n    exit 1\nfi\n\nprint_success \"Fichiers Odoo réels présents\"\n\n# Vérification Node.js\nif ! command -v node &> /dev/null; then\n    print_error \"Node.js n'est pas installé\"\n    exit 1\nfi\n\nprint_success \"Node.js disponible\"\n\n# Vérification des dépendances\nprint_step \"Vérification des dépendances...\"\ncd mobile_app_web\n\nif [ ! -d \"node_modules\" ]; then\n    print_warning \"Installation des dépendances...\"\n    npm install\nfi\n\n# Vérification xmlrpc\nif ! npm list xmlrpc &> /dev/null; then\n    print_warning \"Installation xmlrpc...\"\n    npm install xmlrpc\nfi\n\nprint_success \"Dépendances vérifiées\"\ncd ..\n\n# Vérification de la connexion Odoo\nprint_step \"Vérification de la connexion Odoo...\"\nODOO_URL=\"http://localhost:8077\"\nif curl -s --connect-timeout 5 \"$ODOO_URL\" > /dev/null; then\n    print_success \"Odoo accessible sur le port 8077\"\nelse\n    print_warning \"Odoo non accessible - Mode fallback sera utilisé\"\nfi\n\n# Création des répertoires\nmkdir -p pids\nmkdir -p logs\n\n# Nettoyage des processus existants\nprint_step \"Nettoyage des processus existants...\"\nif [ -f \"$PID_FILE\" ]; then\n    OLD_PID=$(cat \"$PID_FILE\")\n    if ps -p $OLD_PID > /dev/null 2>&1; then\n        kill $OLD_PID\n        sleep 2\n    fi\n    rm -f \"$PID_FILE\"\nfi\n\n# Nettoyage par port\npkill -f \"server_odoo_real.js\" 2>/dev/null || true\nsleep 1\n\nprint_success \"Processus nettoyés\"\n\n# Démarrage du serveur Odoo réel\nprint_step \"Démarrage du serveur SAMA CONAI Odoo réel...\"\ncd mobile_app_web\nnohup node server_odoo_real.js > \"../$LOG_FILE\" 2>&1 &\nSERVER_PID=$!\necho $SERVER_PID > \"../$PID_FILE\"\ncd ..\n\nsleep 3\n\n# Vérification du démarrage\nif ps -p $SERVER_PID > /dev/null 2>&1; then\n    print_success \"Serveur Odoo réel démarré (PID: $SERVER_PID)\"\nelse\n    print_error \"Échec du démarrage du serveur\"\n    exit 1\nfi\n\n# Test de connectivité\nprint_step \"Test de connectivité...\"\nsleep 2\n\nif curl -s \"http://localhost:$PORT\" > /dev/null; then\n    print_success \"Interface Odoo réelle accessible\"\nelse\n    print_error \"Interface non accessible\"\n    exit 1\nfi\n\n# Test API Odoo\nprint_step \"Test API Odoo...\"\nODOO_TEST_RESULT=$(curl -s \"http://localhost:$PORT/api/odoo/test\" | grep -o '\"success\":[^,]*' || echo '\"success\":false')\nif echo \"$ODOO_TEST_RESULT\" | grep -q '\"success\":true'; then\n    print_success \"Connexion Odoo fonctionnelle\"\nelse\n    print_warning \"Connexion Odoo échouée - Mode fallback actif\"\nfi\n\necho \"\"\necho -e \"${PURPLE}🎉 SAMA CONAI Version Odoo Réelle Lancée !${NC}\"\necho \"===========================================\"\necho \"\"\n\necho -e \"${CYAN}🔗 Accès à la version Odoo réelle :${NC}\"\necho \"   http://localhost:$PORT/\"\necho \"\"\n\necho -e \"${CYAN}🔧 Comparaison avec version simulée :${NC}\"\necho \"   http://localhost:3007/enriched (Données simulées)\"\necho \"   http://localhost:$PORT/ (Données Odoo réelles)\"\necho \"\"\n\necho -e \"${CYAN}📊 APIs spécifiques :${NC}\"\necho \"   http://localhost:$PORT/api/odoo/test (Test connexion)\"\necho \"   http://localhost:$PORT/api/mobile/level1/dashboard (Dashboard)\"\necho \"   http://localhost:$PORT/api/mobile/level2/requests (Demandes)\"\necho \"   http://localhost:$PORT/api/mobile/level2/alerts (Alertes)\"\necho \"\"\n\necho -e \"${CYAN}🔗 Backend Odoo :${NC}\"\necho \"   http://localhost:8077\"\necho \"\"\n\necho -e \"${CYAN}👤 Connexion :${NC}\"\necho \"   Utilisateur: admin\"\necho \"   Mot de passe: admin\"\necho \"\"\n\necho -e \"${CYAN}✨ Développement progressif :${NC}\"\necho \"   ✅ Phase 1: Dashboard avec données Odoo réelles\"\necho \"   ✅ Phase 2: Listes avec données Odoo (si disponibles)\"\necho \"   🚧 Phase 3: Détails complets (en développement)\"\necho \"\"\n\necho -e \"${CYAN}📊 Indicateurs de source :${NC}\"\necho \"   🟢 Odoo: Données réelles d'Odoo\"\necho \"   🟡 Fallback: Données simulées (si Odoo indisponible)\"\necho \"   🔵 Development: Fonctionnalité en développement\"\necho \"\"\n\necho -e \"${CYAN}🛑 Pour arrêter :${NC}\"\necho \"   ./stop_odoo_real_sama_conai.sh\"\necho \"\"\n\necho -e \"${CYAN}📊 Logs en temps réel :${NC}\"\necho \"   tail -f $LOG_FILE\"\necho \"\"\n\n# Ouverture automatique du navigateur\nprint_step \"Ouverture du navigateur...\"\nif command -v xdg-open > /dev/null; then\n    xdg-open \"http://localhost:$PORT\" &\nelif command -v open > /dev/null; then\n    open \"http://localhost:$PORT\" &\nfi\n\nprint_success \"SAMA CONAI Version Odoo Réelle est prêt à l'utilisation !\"\n\necho \"\"\necho \"===========================================\"\necho \"🇸🇳 SAMA CONAI - Version Odoo Réelle Active\"\necho \"===========================================\"