<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        
        <!-- Template du Tableau de Bord avec Données Réelles et Actions Utilisateur -->
        <template id="transparency_dashboard_template" name="Tableau de Bord de la Transparence">
            <html>
            <head>
                <title>Tableau de Bord de la Transparence - SAMA CONAI</title>
                <meta charset="utf-8"/>
                <meta name="viewport" content="width=device-width, initial-scale=1"/>
                <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
                <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"/>
                <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                <style>
                    .metric-card {
                        cursor: pointer;
                        transition: all 0.3s ease;
                    }
                    .metric-card:hover {
                        transform: translateY(-5px);
                        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
                    }
                    .real-data-badge {
                        background: linear-gradient(45deg, #28a745, #20c997);
                        color: white;
                        padding: 5px 10px;
                        border-radius: 15px;
                        font-size: 0.8em;
                        font-weight: bold;
                    }
                    .user-info-card {
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        border-radius: 10px;
                        padding: 15px;
                        margin-bottom: 20px;
                    }
                    .action-card {
                        transition: all 0.3s ease;
                        border: 2px solid transparent;
                    }
                    .action-card:hover {
                        border-color: #007bff;
                        transform: translateY(-3px);
                    }
                </style>
            </head>
            <body>
                <div id="wrap">
                    
                    <!-- Header -->
                    <div class="bg-primary text-white py-5">
                        <div class="container">
                            <div class="row align-items-center">
                                <div class="col-lg-8">
                                    <h1 class="display-4 mb-3">
                                        <i class="fa fa-dashboard"/> Tableau de Bord de la Transparence
                                    </h1>
                                    <p class="lead mb-0">
                                        Suivi en temps réel - Données 100% réelles du backend SAMA CONAI
                                    </p>
                                </div>
                                <div class="col-lg-4 text-end">
                                    <div class="card bg-light text-dark">
                                        <div class="card-body">
                                            <h6 class="card-title mb-1">Dernière mise à jour</h6>
                                            <p class="card-text mb-0">
                                                <small><t t-esc="last_update" t-options="{'widget': 'datetime'}"/></small>
                                            </p>
                                            <button onclick="location.reload()" class="btn btn-sm btn-outline-primary mt-2">
                                                <i class="fa fa-refresh"/> Actualiser
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="container my-5">
                        
                        <!-- Informations utilisateur -->
                        <t t-if="user_info.get('is_authenticated')">
                            <div class="user-info-card">
                                <div class="row align-items-center">
                                    <div class="col-md-8">
                                        <h5 class="mb-1">
                                            <i class="fa fa-user"/> Bienvenue, <t t-esc="user_info.get('name', '')"/>
                                        </h5>
                                        <p class="mb-0">
                                            <i class="fa fa-envelope"/> <t t-esc="user_info.get('email', '')"/>
                                        </p>
                                    </div>
                                    <div class="col-md-4 text-end">
                                        <span class="badge bg-success">
                                            <i class="fa fa-check"/> Utilisateur connecté
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </t>
                        
                        <!-- Statistiques principales -->
                        <div class="row mb-5">
                            <div class="col-12">
                                <h2>
                                    <i class="fa fa-bar-chart"/> Statistiques Générales 
                                    <span class="real-data-badge">Backend Réel</span>
                                </h2>
                                <p class="text-muted">Données extraites directement de la base SAMA CONAI</p>
                            </div>
                            
                            <div class="col-lg-3 col-md-6 mb-4">
                                <div class="card border-primary h-100 metric-card">
                                    <div class="card-body text-center">
                                        <i class="fa fa-file-text fa-3x text-primary mb-3"/>
                                        <h3 class="text-primary">
                                            <t t-esc="stats.get('total_requests', 0) if stats else 0"/>
                                        </h3>
                                        <p class="mb-2">Demandes d'Information</p>
                                        <small class="text-muted">
                                            <i class="fa fa-clock-o"/> 
                                            <t t-esc="stats.get('recent_requests', 0) if stats else 0"/> ce mois
                                        </small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-3 col-md-6 mb-4">
                                <div class="card border-success h-100 metric-card">
                                    <div class="card-body text-center">
                                        <i class="fa fa-check-circle fa-3x text-success mb-3"/>
                                        <h3 class="text-success">
                                            <t t-esc="stats.get('processing_rate', 0) if stats else 0"/>%
                                        </h3>
                                        <p class="mb-2">Taux de Traitement</p>
                                        <small class="text-muted">
                                            <t t-esc="stats.get('processed_requests', 0) if stats else 0"/> sur 
                                            <t t-esc="stats.get('total_requests', 0) if stats else 0"/> traitées
                                        </small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-3 col-md-6 mb-4">
                                <div class="card border-info h-100 metric-card">
                                    <div class="card-body text-center">
                                        <i class="fa fa-clock-o fa-3x text-info mb-3"/>
                                        <h3 class="text-info">
                                            <t t-esc="stats.get('avg_processing_days', 0) if stats else 0"/>
                                        </h3>
                                        <p class="mb-2">Jours en Moyenne</p>
                                        <small class="text-muted">
                                            Délai réel calculé<br/>
                                            <strong>Objectif: &lt; 30 jours</strong>
                                        </small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-3 col-md-6 mb-4">
                                <div class="card border-warning h-100 metric-card">
                                    <div class="card-body text-center">
                                        <i class="fa fa-calendar-check-o fa-3x text-warning mb-3"/>
                                        <h3 class="text-warning">
                                            <t t-esc="stats.get('on_time_rate', 0) if stats else 0"/>%
                                        </h3>
                                        <p class="mb-2">Dans les Délais</p>
                                        <small class="text-muted">
                                            Calcul réel des délais<br/>
                                            <strong>(30 jours légaux)</strong>
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Graphiques -->
                        <div class="row mb-5">
                            <div class="col-12">
                                <h2>
                                    <i class="fa fa-line-chart"/> Tendances et Analyses 
                                    <span class="real-data-badge">Données Live</span>
                                </h2>
                            </div>
                            
                            <!-- Évolution mensuelle -->
                            <div class="col-lg-8 mb-4">
                                <div class="card h-100">
                                    <div class="card-header">
                                        <h5 class="mb-0">
                                            <i class="fa fa-line-chart"/> Évolution des Demandes (6 derniers mois)
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="monthlyChart" height="100"></canvas>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Répartition par état -->
                            <div class="col-lg-4 mb-4">
                                <div class="card h-100">
                                    <div class="card-header">
                                        <h5 class="mb-0">
                                            <i class="fa fa-pie-chart"/> État des Demandes
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="statusChart" height="150"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Accès rapide aux services avec actions utilisateur -->
                        <div class="row mb-5">
                            <div class="col-12">
                                <h2><i class="fa fa-rocket"/> Accès Rapide aux Services</h2>
                                <t t-if="user_info.get('is_authenticated')">
                                    <p class="text-success">
                                        <i class="fa fa-check"/> Vous êtes connecté - Accès complet aux services
                                    </p>
                                </t>
                                <t t-else="">
                                    <p class="text-info">
                                        <i class="fa fa-info-circle"/> 
                                        <a href="/web/login?redirect=/transparence-dashboard">Connectez-vous</a> 
                                        pour accéder aux services personnalisés
                                    </p>
                                </t>
                            </div>
                            
                            <!-- Nouvelle demande d'information -->
                            <div class="col-lg-3 col-md-6 mb-4">
                                <div class="card border-primary h-100 action-card">
                                    <div class="card-body text-center">
                                        <i class="fa fa-file-text-o fa-3x text-primary mb-3"/>
                                        <h5>Nouvelle Demande</h5>
                                        <p>Demander l'accès à une information publique</p>
                                        
                                        <t t-if="user_info.get('is_authenticated')">
                                            <a href="/transparence-dashboard/new-request" class="btn btn-primary">
                                                <i class="fa fa-plus"/> Créer dans SAMA CONAI
                                            </a>
                                            <br/>
                                            <small class="text-muted mt-2 d-block">ou</small>
                                            <a href="/acces-information" class="btn btn-outline-primary btn-sm mt-1">
                                                <i class="fa fa-globe"/> Formulaire public
                                            </a>
                                        </t>
                                        <t t-else="">
                                            <a href="/acces-information" class="btn btn-primary">
                                                <i class="fa fa-plus"/> Commencer
                                            </a>
                                            <br/>
                                            <small class="text-muted mt-2 d-block">
                                                <a href="/web/login?redirect=/transparence-dashboard">Se connecter</a> 
                                                pour plus d'options
                                            </small>
                                        </t>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Mes demandes -->
                            <div class="col-lg-3 col-md-6 mb-4">
                                <div class="card border-info h-100 action-card">
                                    <div class="card-body text-center">
                                        <i class="fa fa-search fa-3x text-info mb-3"/>
                                        <h5>Mes Demandes</h5>
                                        <p>Suivre l'état de mes demandes en cours</p>
                                        
                                        <t t-if="user_info.get('is_authenticated')">
                                            <a href="/transparence-dashboard/my-requests" class="btn btn-info">
                                                <i class="fa fa-list"/> Voir dans SAMA CONAI
                                            </a>
                                            <br/>
                                            <small class="text-muted mt-2 d-block">ou</small>
                                            <a href="/my/information-requests" class="btn btn-outline-info btn-sm mt-1">
                                                <i class="fa fa-globe"/> Portail public
                                            </a>
                                        </t>
                                        <t t-else="">
                                            <a href="/my/information-requests" class="btn btn-info">
                                                <i class="fa fa-search"/> Suivre
                                            </a>
                                            <br/>
                                            <small class="text-muted mt-2 d-block">
                                                <a href="/web/login?redirect=/transparence-dashboard">Se connecter</a> 
                                                pour plus d'options
                                            </small>
                                        </t>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Signalement -->
                            <div class="col-lg-3 col-md-6 mb-4">
                                <div class="card border-warning h-100 action-card">
                                    <div class="card-body text-center">
                                        <i class="fa fa-shield fa-3x text-warning mb-3"/>
                                        <h5>Signalement</h5>
                                        <p>Signaler une irrégularité en toute sécurité</p>
                                        
                                        <t t-if="user_info.get('is_authenticated')">
                                            <a href="/transparence-dashboard/new-alert" class="btn btn-warning">
                                                <i class="fa fa-shield"/> Créer dans SAMA CONAI
                                            </a>
                                            <br/>
                                            <small class="text-muted mt-2 d-block">ou</small>
                                            <a href="/signalement-anonyme" class="btn btn-outline-warning btn-sm mt-1">
                                                <i class="fa fa-user-secret"/> Anonyme
                                            </a>
                                        </t>
                                        <t t-else="">
                                            <a href="/signalement-anonyme" class="btn btn-warning">
                                                <i class="fa fa-shield"/> Signaler
                                            </a>
                                            <br/>
                                            <small class="text-muted mt-2 d-block">
                                                <a href="/web/login?redirect=/transparence-dashboard">Se connecter</a> 
                                                pour plus d'options
                                            </small>
                                        </t>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Aide et contact -->
                            <div class="col-lg-3 col-md-6 mb-4">
                                <div class="card border-secondary h-100 action-card">
                                    <div class="card-body text-center">
                                        <i class="fa fa-question-circle fa-3x text-secondary mb-3"/>
                                        <h5>Aide et Contact</h5>
                                        <p>Besoin d'assistance ou d'informations ?</p>
                                        <a href="/transparence-dashboard/help" class="btn btn-secondary">
                                            <i class="fa fa-envelope"/> Contacter
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Statistiques des signalements -->
                        <div class="row mb-5">
                            <div class="col-12">
                                <h2>
                                    <i class="fa fa-shield"/> Signalements d'Alerte 
                                    <span class="real-data-badge">Données Anonymisées</span>
                                </h2>
                            </div>
                            
                            <div class="col-lg-3 col-md-6 mb-4">
                                <div class="card border-danger h-100">
                                    <div class="card-body text-center">
                                        <i class="fa fa-exclamation-triangle fa-3x text-danger mb-3"/>
                                        <h3 class="text-danger">
                                            <t t-esc="stats.get('total_alerts', 0) if stats else 0"/>
                                        </h3>
                                        <p class="mb-2">Signalements Reçus</p>
                                        <small class="text-muted">Protection des lanceurs d'alerte</small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-3 col-md-6 mb-4">
                                <div class="card border-success h-100">
                                    <div class="card-body text-center">
                                        <i class="fa fa-check fa-3x text-success mb-3"/>
                                        <h3 class="text-success">
                                            <t t-esc="stats.get('resolved_alerts', 0) if stats else 0"/>
                                        </h3>
                                        <p class="mb-2">Signalements Résolus</p>
                                        <small class="text-muted">Traitement terminé</small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-3 col-md-6 mb-4">
                                <div class="card border-info h-100">
                                    <div class="card-body text-center">
                                        <i class="fa fa-hourglass-half fa-3x text-info mb-3"/>
                                        <h3 class="text-info">
                                            <t t-esc="stats.get('pending_alerts', 0) if stats else 0"/>
                                        </h3>
                                        <p class="mb-2">En Cours de Traitement</p>
                                        <small class="text-muted">Investigation en cours</small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-3 col-md-6 mb-4">
                                <div class="card border-primary h-100">
                                    <div class="card-body text-center">
                                        <i class="fa fa-percent fa-3x text-primary mb-3"/>
                                        <h3 class="text-primary">
                                            <t t-esc="stats.get('alert_resolution_rate', 0) if stats else 0"/>%
                                        </h3>
                                        <p class="mb-2">Taux de Résolution</p>
                                        <small class="text-muted">Efficacité du traitement</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Informations légales -->
                        <div class="row">
                            <div class="col-12">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h5><i class="fa fa-info-circle"/> À propos de ce tableau de bord</h5>
                                        <div class="row">
                                            <div class="col-md-8">
                                                <p>
                                                    Ce tableau de bord présente les statistiques de transparence en temps réel, 
                                                    extraites directement de la base de données SAMA CONAI.
                                                </p>
                                                <ul class="list-unstyled">
                                                    <li><i class="fa fa-check text-success"/> Données 100% réelles du backend</li>
                                                    <li><i class="fa fa-check text-success"/> Actions utilisateur intégrées</li>
                                                    <li><i class="fa fa-check text-success"/> Respect de la confidentialité</li>
                                                    <li><i class="fa fa-check text-success"/> Conformité légale garantie</li>
                                                </ul>
                                            </div>
                                            <div class="col-md-4">
                                                <p><strong>Base légale :</strong> Loi sénégalaise sur l'accès à l'information publique</p>
                                                <p><strong>Délai légal :</strong> 30 jours pour répondre aux demandes</p>
                                                <p><strong>Source des données :</strong> Base SAMA CONAI en temps réel</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                </div>
                
                <!-- Scripts JavaScript -->
                <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
                <script>
                    // Variables globales
                    let chartsData = <t t-raw="json.dumps(charts_data) if charts_data else '{}'"/>;
                    let charts = {};
                    
                    // Initialisation au chargement de la page
                    document.addEventListener('DOMContentLoaded', function() {
                        initializeCharts();
                    });
                    
                    // Initialiser tous les graphiques
                    function initializeCharts() {
                        try {
                            initMonthlyChart();
                            initStatusChart();
                        } catch (error) {
                            console.error('Erreur lors de l\'initialisation des graphiques:', error);
                        }
                    }
                    
                    // Graphique d'évolution mensuelle
                    function initMonthlyChart() {
                        const ctx = document.getElementById('monthlyChart');
                        if (!ctx) return;
                        
                        const data = chartsData.monthly_requests || [];
                        
                        charts.monthly = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: data.map(item => item.month_name || ''),
                                datasets: [{
                                    label: 'Demandes par mois',
                                    data: data.map(item => item.count || 0),
                                    borderColor: '#0d6efd',
                                    backgroundColor: 'rgba(13, 110, 253, 0.1)',
                                    tension: 0.4,
                                    fill: true
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        display: false
                                    }
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true
                                    }
                                }
                            }
                        });
                    }
                    
                    // Graphique de répartition par état
                    function initStatusChart() {
                        const ctx = document.getElementById('statusChart');
                        if (!ctx) return;
                        
                        const data = chartsData.requests_by_status || [];
                        
                        charts.status = new Chart(ctx, {
                            type: 'doughnut',
                            data: {
                                labels: data.map(item => item.status || ''),
                                datasets: [{
                                    data: data.map(item => item.count || 0),
                                    backgroundColor: [
                                        '#198754', // Répondues - vert
                                        '#0dcaf0', // En traitement - cyan
                                        '#ffc107', // Soumises - jaune
                                        '#fd7e14', // En validation - orange
                                        '#dc3545'  // Refusées - rouge
                                    ]
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'bottom'
                                    }
                                }
                            }
                        });
                    }
                </script>
            </body>
            </html>
        </template>
        
    </data>
</odoo>